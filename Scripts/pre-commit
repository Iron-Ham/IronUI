#!/bin/sh
# Pre-commit hook for IronUI
# Formats Swift files using the Airbnb Swift Style Guide via ironui-cli
#
# Install this hook by running:
#   ln -sf ../../Scripts/pre-commit .git/hooks/pre-commit

set -e

# Check if any Swift files are staged FIRST (before resolving CLI)
if ! git diff --cached --name-only --diff-filter=ACM | grep -q '\.swift$'; then
    echo "No Swift files staged, skipping format."
    exit 0
fi

# Only resolve CLI path when we actually need to format
SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
# Handle both direct execution and symlink from .git/hooks
if [ -f "$SCRIPT_DIR/ironui-cli" ]; then
    CLI="$SCRIPT_DIR/ironui-cli"
else
    # When run from .git/hooks/pre-commit symlink
    CLI="$(cd "$SCRIPT_DIR/../.." && pwd)/Scripts/ironui-cli"
fi

echo "Running swift-format..."

# Run the CLI format command (uses cached binary)
"$CLI" format

# Stage any formatting changes
git add -u

echo "Formatting complete."
